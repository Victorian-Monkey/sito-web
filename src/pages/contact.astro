---
import Layout from '~/layouts/PageLayout.astro';
import HeroText from '~/components/widgets/HeroText.astro';
import ContactUs from '~/components/widgets/Contact.astro';
import Features2 from '~/components/widgets/Features2.astro';
import CTAButton from '~/components/ui/CTAButton.astro';
import Card from '~/components/ui/Card.astro';
import { getApiUrl, API_ENDPOINTS } from '~/config/api';
import { formatPhoneNumber } from '~/utils/ui-utils';

// Fetch contatti data from API
const response = await fetch(getApiUrl(API_ENDPOINTS.CONTATTI));
const contattiData = await response.json();

const metadata = {
  title: 'Contatti - Victorian Monkey | Prenota Tavolo San Lorenzo Roma',
  description: 'Contatta il Victorian Monkey per prenotare un tavolo, informazioni su eventi e giochi. Ludopub a San Lorenzo, Roma.',
};
---

<Layout metadata={metadata}>
  <!-- HeroText Widget ******************* -->

  <HeroText tagline="Contatti" title="Vieni a trovarci!" />

  <ContactUs
    id="form"
    title="Scrivici pure!"
    subtitle="Hai domande sui nostri giochi, vuoi prenotare un tavolo o hai bisogno di informazioni? Siamo qui per te!"
    inputs={[
      {
        type: 'text',
        name: 'name',
        label: 'Nome *',
        placeholder: 'Il tuo nome',
      },
      {
        type: 'email',
        name: 'email',
        label: 'Email *',
        placeholder: 'tua.email@esempio.com',
      },
      {
        type: 'tel',
        name: 'phone',
        label: 'Telefono *',
        placeholder: '351 309 3686',
      },
    ]}
    textarea={{
      label: 'Messaggio',
      placeholder: 'Scrivi qui il tuo messaggio...',
    }}
    disclaimer={{
      label:
        'Inviando questo modulo di contatto, accetti e acconsenti alla raccolta delle tue informazioni personali. Il numero di telefono Ã¨ obbligatorio per permetterci di ricontattarti.',
    }}
    description="Il nostro team risponde solitamente entro 24 ore lavorative."
  />

  <!-- Orari e Trasporti Section **************** -->

  <div class="py-16 bg-gray-50 dark:bg-secondary">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <!-- Orari di Apertura -->
        <Card>
          <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
            ğŸ• Orari di Apertura
          </h3>
          <div class="space-y-4">
            {contattiData.openingHours.map((schedule) => (
              <div class="border-l-4 border-purple-500 pl-4">
                <h4 class="font-semibold text-gray-800 dark:text-white mb-2">
                  {schedule.days.join(', ')}
                </h4>
                <p class="text-gray-600 dark:text-gray-300">
                  {schedule.hours.open} - {schedule.hours.close}
                </p>
              </div>
            ))}
          </div>
        </Card>

        <!-- Come Raggiungerci -->
        <Card>
          <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
            ğŸš‡ Come Raggiungerci
          </h3>
          <div class="space-y-4">
            <div>
              <h4 class="font-semibold text-gray-800 dark:text-white mb-2">
                ğŸš‡ Metro
              </h4>
              <p class="text-gray-600 dark:text-gray-300">
                {contattiData.transport.metro.line} - Stazione {contattiData.transport.metro.station}
                <br>
                <span class="text-sm text-gray-500">({contattiData.transport.metro.walkingTime} a piedi)</span>
              </p>
            </div>
            <div>
              <h4 class="font-semibold text-gray-800 dark:text-white mb-2">
                ğŸšŒ Autobus
              </h4>
              <p class="text-gray-600 dark:text-gray-300">
                Linee {contattiData.transport.bus[0].lines.join(', ')} - Fermata {contattiData.transport.bus[0].stop}
              </p>
            </div>
            <div>
              <h4 class="font-semibold text-gray-800 dark:text-white mb-2">
                ğŸ…¿ï¸ Parcheggio
              </h4>
              <p class="text-gray-600 dark:text-gray-300">
                {contattiData.transport.parking[0].description}
              </p>
            </div>
          </div>
        </Card>

      </div>
    </div>
  </div>

  <!-- Social Media Section **************** -->

  <div class="py-16 bg-white dark:bg-secondary">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-8">
        ğŸ“± Seguici sui Social
      </h3>
      <div class="flex flex-wrap justify-center gap-6">
        {contattiData.socialMedia.map((social) => (
          social.url && (
            <CTAButton 
              href={social.url} 
              text={social.platform === 'facebook' ? 'ğŸ“˜ Facebook' : 
                    social.platform === 'instagram' ? 'ğŸ“· Instagram' :
                    social.platform === 'discord' ? 'ğŸ® Discord' :
                    social.platform === 'youtube' ? 'ğŸ“º YouTube' : social.platform}
              target="_blank"
            />
          )
        ))}
      </div>
    </div>
  </div>

  <!-- Features2 Widget ************** -->

  <Features2
    title="Come contattarci"
    items={[
      {
        title: 'Prenotazioni',
        description: `Chiamaci per prenotare un tavolo, organizzare eventi privati o per qualsiasi domanda sui nostri giochi e servizi.`,
      },
      {
        title: 'Informazioni',
        description:
          'Hai domande sui nostri orari, sui giochi disponibili, sui tornei o su come diventare socio? Siamo qui per te!',
      },
      {
        title: 'Eventi e Tornei',
        description:
          'Vuoi organizzare un torneo, partecipare a un evento speciale o proporre una nuova attivitÃ ? Contattaci!',
      },
      {
        title: 'Telefono',
        description: formatPhoneNumber(contattiData.contact.phone),
        icon: 'tabler:phone',
      },
      {
        title: 'Email',
        description: contattiData.contact.email,
        icon: 'tabler:mail',
      },
      {
        title: 'Indirizzo',
        description: `${contattiData.address.street}, ${contattiData.address.neighborhood}, ${contattiData.address.city}`,
        icon: 'tabler:map-pin',
      },
    ]}
  />
</Layout>
