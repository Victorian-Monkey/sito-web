---
import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import Features from '~/components/widgets/Features.astro';
import Content from '~/components/widgets/Content.astro';
import CTAButton from '~/components/ui/CTAButton.astro';
import Card from '~/components/ui/Card.astro';
import CategoryBadge from '~/components/ui/CategoryBadge.astro';
import FormattedDate from '~/components/ui/FormattedDate.astro';
import StructuredData from '~/components/common/StructuredData.astro';
import { getApiUrl, API_ENDPOINTS } from '~/config/api';
import { formatPhoneNumber } from '~/utils/ui-utils';

// Fetch annunci data from API
const annunciResponse = await fetch(getApiUrl(API_ENDPOINTS.ANNUNCI));
const annunciData = await annunciResponse.json();

// Fetch contatti data from API
const contattiResponse = await fetch(getApiUrl(API_ENDPOINTS.CONTATTI));
const contattiData = await contattiResponse.json();

// Filter active announcements (dateEnd > today)
const today = new Date().toISOString().split('T')[0];
const activeAnnouncements = annunciData.announcements.filter(annuncio => 
  annuncio.dateEnd && annuncio.dateEnd >= today
);

const metadata = {
  title: 'Victorian Monkey - La Tana dei Nerd di Roma | Ludopub San Lorenzo',
  description: 'Il Victorian Monkey √® il ludopub di Roma dove giocare, bere e divertirsi dal 2015. 300+ giochi da tavolo, GdR, birre artigianali e atmosfera unica a San Lorenzo.',
  keywords: 'ludopub Roma, giochi da tavolo Roma, GdR Roma, Victorian Monkey, San Lorenzo, birre artigianali Roma, giochi di ruolo Roma',
  canonical: 'https://victorianmonkey.it',
  openGraph: {
    title: 'Victorian Monkey - La Tana dei Nerd di Roma',
    description: 'Il ludopub di Roma dove giocare, bere e divertirsi dal 2015. 300+ giochi da tavolo, GdR e birre artigianali.',
    type: 'website',
    locale: 'it_IT',
    siteName: 'Victorian Monkey',
    image: {
      src: 'https://victorianmonkey.it/hero-image.png',
      alt: 'Victorian Monkey - La Tana dei Nerd di Roma'
    }
  },
  ignoreTitleTemplate: true,
};
---

<Layout metadata={metadata}>
  <!-- Hero Widget ******************* -->

  <Hero
    actions={[
      {
        variant: 'primary',
        text: 'üëâ Prenota un tavolo',
        href: '/contatti',
        icon: 'tabler:calendar-plus',
      },
      { 
        text: 'ü™ô Diventa Socio', 
        href: '/contatti',
        icon: 'tabler:credit-card',
      },
    ]}
    image={{ src: '~/assets/images/monkey-logo.svg', alt: 'Victorian Monkey - La Tana dei Nerd', class: 'mx-auto hero-logo' }}
  >
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-gradient-to-br from-primary/10 to-secondary/20 dark:from-primary/20 dark:to-secondary/40"></div>
    </Fragment>
    <Fragment slot="title">
      <div class="flex flex-col items-center justify-center mb-4">
        <img src="/src/assets/images/monkey-logo.svg" alt="Victorian Monkey Logo" class="w-16 h-16 mb-4" />
        <div class="text-center">
          <span class="text-4xl md:text-5xl font-bold text-white mb-2">Benvenuti al</span>
          <div class="flex justify-center">
            <img src="/src/assets/images/logo-text.svg" alt="Victorian Monkey - La Tana dei Nerd di Roma" class="h-12 md:h-16 logo-text" style="object-fit: contain;" />
          </div>
        </div>
      </div>
    </Fragment>

    <Fragment slot="subtitle">
      <span class="font-semibold">La tana dei nerd di Roma</span> ‚Äì giochi, drink e risate dal 2015
      <br><br>
      Dal 2015 siamo il punto di ritrovo per chi ama i giochi da tavolo, i GdR, le birre artigianali e le serate in buona compagnia.
      <br><br>
      Che tu venga per lanciare i dadi, per una partita a Risiko o solo per una pinta in pace‚Ä¶ qui sei nel posto giusto.
      <br><br>
      <a href="/regolamento" class="text-sm text-primary hover:underline">
        ‚öñÔ∏è Leggi il nostro regolamento
      </a>
    </Fragment>
  </Hero>

  <!-- Announcements Section ******************* -->

  <div class="bg-gray-50 dark:bg-secondary py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">
          üìú Annunci dalla Tana
        </h2>
        <p class="text-lg text-gray-600 dark:text-gray-300 mb-8 max-w-3xl mx-auto">
          Resta aggiornato su eventi, tornei, serate speciali e comunicazioni per i soci del Victorian Monkey.
          <br>
          La community cresce‚Ä¶ e tu puoi farne parte!
        </p>
        
        {activeAnnouncements.length > 0 ? (
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            {activeAnnouncements.slice(0, 3).map((annuncio) => (
              <Card className="mb-4 bg-white dark:bg-secondary border-accent border-[1px]">
                <div class="flex items-center justify-between mb-3">
                  <CategoryBadge color={annunciData.categories.find(c => c.id === annuncio.category)?.color || 'gray'}>
                    {annunciData.categories.find(c => c.id === annuncio.category)?.name}
                  </CategoryBadge>
                  <FormattedDate dateString={annuncio.date} />
                </div>
                <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">
                  {annuncio.title}
                </h3>
                <p class="text-gray-600 dark:text-white/80 mb-4">
                  {annuncio.excerpt}
                </p>
                {annuncio.priority === 'high' && (
                  <div class="mb-3">
                    <span class="px-2 py-1 bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded-full text-xs font-medium">
                      IMPORTANTE
                    </span>
                  </div>
                )}
                <div class="text-sm text-gray-500 dark:text-white/70">
                  Scade: <FormattedDate dateString={annuncio.dateEnd} />
                </div>
              </Card>
            ))}
          </div>
        ) : (
          <Card className="mb-8">
            <p class="text-gray-600 dark:text-gray-300">
              Al momento non ci sono annunci attivi. Torna presto per le ultime novit√†!
            </p>
          </Card>
        )}
        
        <CTAButton 
          href="/comunicazioni" 
          text="‚û°Ô∏è Leggi tutti gli annunci"
          variant="secondary"
        />
      </div>
    </div>
  </div>

  <!-- Features Widget *************** -->

  <Features
    id="gaming"
    tagline="Il nostro locale"
    title="üé≤ Gioca. Bevi. Ridi. Ripeti."
    subtitle="Pi√π di 300 giochi da tavolo, una collezione in continua espansione, master di ruolo pronti a farti vivere avventure epiche e un men√π pensato per i veri avventurieri del gusto. Che tu sia un elfo ladro o un umano stanco del traffico romano, qui troverai rifugio, birra fresca e buona compagnia."
  >
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-white dark:bg-secondary"></div>
    </Fragment>
    items={[
      {
        title: '300+ Giochi da Tavolo',
        description:
          'Una collezione in continua espansione: dai classici intramontabili alle ultime novit√† del mercato. C\'√® sempre qualcosa di nuovo da scoprire.',
        icon: 'tabler:device-gamepad-2',
      },
      {
        title: 'Master di Ruolo Esperti',
        description:
          'I nostri master sono pronti a farti vivere avventure epiche in mondi fantastici. D&D, Pathfinder, Call of Cthulhu e molto altro.',
        icon: 'tabler:sword',
      },
      {
        title: 'Men√π per Avventurieri',
        description:
          'Un men√π pensato per i veri avventurieri del gusto: birre artigianali, panini gourmet e snack per non perdere mai la concentrazione.',
        icon: 'tabler:beer',
      },
      {
        title: 'Atmosfera Unica',
        description:
          'Un ambiente che profuma di avventure, risate e buona compagnia. Il posto perfetto per dimenticare lo stress quotidiano.',
        icon: 'tabler:home-heart',
      },
      {
        title: 'Eventi e Tornei',
        description:
          'Serate speciali, tornei, presentazioni di nuovi giochi e molto altro. C\'√® sempre qualcosa di interessante in programma.',
        icon: 'tabler:calendar-event',
      },
      {
        title: 'Community Accogliente',
        description:
          'Un posto dove tutti sono benvenuti, dai principianti ai veterani. La passione per i giochi ci unisce tutti.',
        icon: 'tabler:users',
      },
    ]}
  </Features>

  <!-- Menu CTA Section **************** -->

  <div class="bg-gray-50 dark:bg-secondary py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <CTAButton 
        href="/menu" 
        text="üçî Scopri il nostro men√π"
        variant="secondary"
        size="lg"
      />
    </div>
  </div>

  <!-- Content Widget **************** -->

  <Content
    isReversed
    tagline="La nostra storia"
    title="üß≠ Dal 2015, nerd con stile."
    items={[
      {
        title: 'Un sogno tra amici',
        description:
          'Il Victorian Monkey nasce a San Lorenzo come un piccolo sogno tra amici: creare una tana dove divertirsi senza pensare a nulla.',
      },
      {
        title: 'Una casa per giocatori',
        description:
          'Oggi √® una casa per giocatori, sognatori e curiosi. Un posto dove la passione per i giochi si incontra con la buona compagnia.',
      },
      {
        title: 'Stile vittoriano',
        description:
          'E s√¨, ci piace un tocco di stile vittoriano. Perch√© anche i nerd hanno diritto alla classe e all\'eleganza.',
      },
    ]}
    image={{
      src: 'https://images.unsplash.com/photo-1519389950473-47ba0277781c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80',
      alt: 'Victorian Monkey - La Tana dei Nerd',
    }}
  >
    <Fragment slot="content">
      <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">Una storia di passione e amicizia</h3>
      Dal 2015, il Victorian Monkey √® cresciuto insieme alla community romana dei giocatori, diventando un punto di riferimento per chi ama i giochi da tavolo e i GdR.
    </Fragment>

    <Fragment slot="bg">
      <div class="absolute inset-0 bg-gray-50 dark:bg-secondary"></div>
    </Fragment>
  </Content>

  <!-- Story CTA Section **************** -->

  <div class="bg-gray-50 dark:bg-secondary py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <CTAButton 
        href="#chi-siamo" 
        text="üìñ Scopri la nostra storia"
        variant="primary"
        size="lg"
      />
    </div>
  </div>

  <!-- Content Widget **************** -->

  <Content
    isAfterContent
    id="contatti"
    items={[
      {
        title: 'üìç Via dei Piceni 29, San Lorenzo ‚Äì Roma',
        description: 'Ci trovi nel cuore di San Lorenzo, facilmente raggiungibile con i mezzi pubblici e a piedi dal centro storico.',
      },
      {
        title: 'üïê Aperti ogni sera',
        description:
          'Siamo aperti ogni sera con giochi, buon cibo e un\'atmosfera che profuma di avventure (e patatine fritte).',
      },
      {
        title: 'üé≤ Prenota il tuo tavolo',
        description:
          'Prenota il tuo tavolo per assicurarti un posto nella nostra tana. Gruppi grandi o piccoli, tutti sono benvenuti.',
      },
      {
        title: 'üç∫ Birre artigianali e buon cibo',
        description:
          'Un men√π pensato per i veri avventurieri: birre artigianali, panini gourmet e snack per non perdere mai la concentrazione.',
      },
    ]}
    image={{
      src: 'https://images.unsplash.com/photo-1600132806370-bf17e65e942f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2194&q=80',
      alt: 'Victorian Monkey - Via dei Piceni 29',
    }}
  >
    <Fragment slot="content">
      <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">üìç Vieni a lanciare i dadi con noi</h3>
      Ci trovi in Via dei Piceni 29, San Lorenzo ‚Äì Roma.
      <br>
      Aperti ogni sera con giochi, buon cibo e un'atmosfera che profuma di avventure (e patatine fritte).
    </Fragment>

    <Fragment slot="bg">
      <div class="absolute inset-0 bg-gray-50 dark:bg-secondary"></div>
    </Fragment>
  </Content>

  <!-- Directions CTA Section **************** -->

  <div class="bg-orange-50 dark:bg-orange-900/20 py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <CTAButton 
        href="https://maps.google.com/?q=Via+dei+Piceni+29,+Roma" 
        text="üó∫Ô∏è Come raggiungerci"
        variant="secondary"
        size="lg"
        target="_blank"
      />
    </div>
  </div>

  <!-- Final CTA Section **************** -->

  <div class="bg-gradient-to-r from-primary to-secondary py-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-4xl font-bold text-white mb-6">
        üé≤ Pronto per la tua prossima avventura?
      </h2>
      <p class="text-xl text-white/90 mb-8 max-w-3xl mx-auto">
        Vieni a trovarci al Victorian Monkey e scopri perch√© dal 2015 siamo la tana preferita dei nerd di Roma.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <CTAButton 
          href="/contatti" 
          text="üéØ Prenota un tavolo"
          variant="outline"
          size="lg"
        />
        <CTAButton 
          href="https://maps.google.com/?q=Via+dei+Piceni+29,+Roma" 
          text="üó∫Ô∏è Come raggiungerci"
          variant="outline"
          size="lg"
          target="_blank"
        />
        <CTAButton 
          href="/regolamento" 
          text="‚öñÔ∏è Regolamento"
          variant="outline"
          size="lg"
        />
      </div>
    </div>
  </div>
</Layout>

<!-- Structured Data -->
<StructuredData 
  type="LocalBusiness"
  data={{
    name: "Victorian Monkey",
    description: "Ludopub di Roma specializzato in giochi da tavolo, GdR e birre artigianali",
    url: "https://victorianmonkey.it",
    telephone: formatPhoneNumber(contattiData.contact.phone),
    email: contattiData.contact.email,
    address: {
      "@type": "PostalAddress",
      streetAddress: contattiData.address.street,
      addressLocality: contattiData.address.city,
      addressRegion: "Lazio",
      postalCode: "00185",
      addressCountry: "IT"
    },
    geo: {
      "@type": "GeoCoordinates",
      latitude: "41.9028",
      longitude: "12.4964"
    },
    openingHours: [
      "Mo-Th 19:00-02:00",
      "Fr-Su 19:00-03:00"
    ],
    priceRange: "‚Ç¨‚Ç¨",
    servesCuisine: "Italiana",
    amenityFeature: [
      "Giochi da tavolo",
      "Giochi di ruolo",
      "Birre artigianali",
      "Cocktail",
      "WiFi gratuito"
    ],
    sameAs: [
      "https://www.facebook.com/victorianmonkey",
      "https://www.instagram.com/victorianmonkey"
    ]
  }}
/>
