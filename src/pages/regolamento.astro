---
import Layout from '~/layouts/PageLayout.astro';
import { getApiUrl, API_ENDPOINTS } from '~/config/api';

// Fetch regolamento data from API
const response = await fetch(getApiUrl(API_ENDPOINTS.REGOLAMENTO));
const regolamentoData = await response.json();

const metadata = {
  title: regolamentoData.metadata.title,
  description: regolamentoData.metadata.description,
  ignoreTitleTemplate: true,
};

// Helper function to get icon color classes
const getIconColorClasses = (color: string) => {
  const colorMap: Record<string, string> = {
    yellow: 'bg-yellow-100 dark:bg-yellow-900',
    green: 'bg-green-100 dark:bg-green-900',
    blue: 'bg-primary/20 dark:bg-primary/30',
    purple: 'bg-purple-100 dark:bg-purple-900',
    red: 'bg-red-100 dark:bg-red-900',
    pink: 'bg-pink-100 dark:bg-pink-900',
    gray: 'bg-gray-100 dark:bg-secondary/20',
  };
  return colorMap[color] || 'bg-gray-100 dark:bg-secondary/20';
};

// Helper function to get special section classes
const getSpecialSectionClasses = (isSpecial: boolean) => {
  return isSpecial 
    ? 'bg-gradient-to-r from-primary/10 to-secondary/10 dark:from-primary/20 dark:to-secondary/20'
    : 'bg-white dark:bg-secondary';
};
---

<Layout metadata={metadata}>
  <!-- Hero Section -->
  <div class="bg-gradient-to-r from-primary to-secondary py-20">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="text-4xl md:text-5xl font-bold text-white mb-6">
        {regolamentoData.hero.title}
      </h1>
      <p class="text-xl text-white/80 mb-4">
        {regolamentoData.hero.subtitle}
      </p>
      <p class="text-lg text-white/70 max-w-3xl mx-auto">
        {regolamentoData.hero.description}
      </p>
    </div>
  </div>

  <!-- Content Section -->
  <div class="py-16 bg-gray-50 dark:bg-secondary">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      
      {regolamentoData.rules.map((rule) => (
        <div class={`${getSpecialSectionClasses(rule.special || false)} rounded-lg shadow-lg p-8 mb-8`}>
          <div class="flex items-start">
            <div class="flex-shrink-0">
              <div class={`w-12 h-12 ${getIconColorClasses(rule.iconColor)} rounded-full flex items-center justify-center text-2xl`}>
                {rule.icon}
              </div>
            </div>
            <div class="ml-6">
              <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
                {rule.number}. {rule.title}
              </h2>
              <div class="text-gray-700 dark:text-gray-300 space-y-3">
                {rule.content.map((item) => (
                  <p>{item}</p>
                ))}
                {rule.highlight && (
                  <p class="font-semibold text-primary dark:text-primary">
                    {rule.highlight}
                  </p>
                )}
                {rule.note && (
                  <p class="text-sm text-gray-500 dark:text-gray-400">
                    {rule.note}
                  </p>
                )}
              </div>
            </div>
          </div>
        </div>
      ))}

      <!-- CTA Section -->
      <div class="text-center mt-12">
        <div class="bg-white dark:bg-secondary rounded-lg shadow-lg p-8">
          <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
            {regolamentoData.cta.title}
          </h3>
          <p class="text-gray-600 dark:text-gray-300 mb-6">
            {regolamentoData.cta.description}
          </p>
          <div class="flex flex-col sm:flex-row gap-4 justify-center">
            {regolamentoData.cta.buttons.map((button) => (
              <a 
                href={button.href} 
                class={`inline-flex items-center px-8 py-4 text-lg font-medium rounded-md transition-colors duration-200 ${
                  button.variant === 'primary' 
                    ? 'border border-transparent text-white bg-primary hover:bg-primary/90 shadow-lg'
                    : 'border-2 border-primary text-primary hover:bg-primary hover:text-white'
                }`}
              >
                {button.text}
              </a>
            ))}
          </div>
        </div>
      </div>

    </div>
  </div>
</Layout>
