---
import Layout from '~/layouts/PageLayout.astro';
import HeroText from '~/components/widgets/HeroText.astro';
import ContactUs from '~/components/widgets/Contact.astro';
import Features2 from '~/components/widgets/Features2.astro';
import CTAButton from '~/components/ui/CTAButton.astro';
import Card from '~/components/ui/Card.astro';
import { getApiUrl, API_ENDPOINTS } from '~/config/api';
import { formatPhoneNumber } from '~/utils/ui-utils';

// Fetch contatti data from API
const response = await fetch(getApiUrl(API_ENDPOINTS.CONTATTI));
const contattiData = await response.json();

const metadata = {
  title: 'Contatti - Victorian Monkey | Prenota Tavolo San Lorenzo Roma',
  description: 'Contatta il Victorian Monkey per prenotare un tavolo, informazioni su eventi e giochi. Ludopub a San Lorenzo, Roma. Telefono, email e orari.',
  keywords: 'contatti Victorian Monkey, prenota tavolo Roma, San Lorenzo contatti, ludopub Roma telefono, Victorian Monkey indirizzo',
  canonical: 'https://victorianmonkey.it/contatti',
  openGraph: {
    title: 'Contatti - Victorian Monkey | Prenota Tavolo Roma',
    description: 'Contatta il Victorian Monkey per prenotare un tavolo e informazioni.',
    type: 'website',
    locale: 'it_IT',
    siteName: 'Victorian Monkey',
    image: {
      src: 'https://victorianmonkey.it/contact-image.jpg',
      alt: 'Contatti Victorian Monkey'
    }
  },
};
---

<Layout metadata={metadata}>
  <!-- HeroText Widget ******************* -->

  <HeroText tagline="Contatti" title="Vieni a trovarci!" />

  <!-- Contact Tabs Section ******************* -->
  
  <div class="py-16 bg-white dark:bg-secondary">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">
          üìû Contattaci
        </h2>
        <p class="text-lg text-gray-600 dark:text-gray-300">
          Scegli il modo pi√π comodo per contattarci
        </p>
      </div>

      <!-- Tab Navigation -->
      <div class="flex flex-col sm:flex-row gap-2 mb-8 bg-gray-100 dark:bg-secondary/20 p-1 rounded-lg">
        <button 
          id="whatsapp-tab" 
          class="tab-button active flex-1 py-3 px-4 text-center font-medium rounded-md transition-colors duration-200 bg-green-500 text-white"
          onclick="switchTab('whatsapp')"
        >
          üí¨ WhatsApp
        </button>
        <button 
          id="form-tab" 
          class="tab-button flex-1 py-3 px-4 text-center font-medium rounded-md transition-colors duration-200 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"
          onclick="switchTab('form')"
        >
          üìù Modulo di Contatto
        </button>
      </div>

      <!-- Tab Content -->
      <div class="tab-content">
        
        <!-- WhatsApp Tab -->
        <div id="whatsapp-content" class="tab-panel active">
          <Card>
            <div class="text-center">
              <div class="mb-6">
                <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                  <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                  </svg>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
                  üí¨ Contattaci su WhatsApp
                </h3>
                <p class="text-gray-600 dark:text-gray-300 mb-6">
                  Il modo pi√π veloce per prenotare un tavolo o fare domande!
                </p>
              </div>
              
              <div class="space-y-4">
                <a 
                  href={`https://wa.me/${contattiData.contact.phone.replace('+', '')}?text=Ciao%20Victorian%20Monkey%2C%20vorrei%20chiedere%20`}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center justify-center w-full sm:w-auto px-8 py-4 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-lg transition-colors duration-200 text-lg"
                >
                  <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                  </svg>
                  Apri WhatsApp
                </a>
                
                <div class="text-sm text-gray-500 dark:text-gray-400">
                  <p>üì± Numero: {formatPhoneNumber(contattiData.contact.phone)}</p>
                  <p>‚è∞ Rispondiamo solitamente entro poche ore</p>
                </div>
              </div>
            </div>
          </Card>
        </div>

        <!-- Form Tab -->
        <div id="form-content" class="tab-panel">
          <ContactUs
            id="form"
            title="Scrivici pure!"
            subtitle="Hai domande sui nostri giochi, vuoi prenotare un tavolo o hai bisogno di informazioni? Siamo qui per te!"
            inputs={[
              {
                type: 'text',
                name: 'name',
                label: 'Nome *',
                placeholder: 'Il tuo nome',
              },
              {
                type: 'email',
                name: 'email',
                label: 'Email *',
                placeholder: 'tua.email@esempio.com',
              },
              {
                type: 'tel',
                name: 'phone',
                label: 'Telefono *',
                placeholder: '351 309 3686',
              },
            ]}
            textarea={{
              label: 'Messaggio',
              placeholder: 'Scrivi qui il tuo messaggio...',
            }}
            disclaimer={{
              label:
                'Inviando questo modulo di contatto, accetti e acconsenti alla raccolta delle tue informazioni personali. Il numero di telefono √® obbligatorio per permetterci di ricontattarti.',
            }}
            description="Il nostro team risponde solitamente entro 24 ore lavorative."
          />
        </div>
      </div>
    </div>
  </div>

  <script is:inline>
    function switchTab(tabName) {
      // Hide all tab panels
      document.querySelectorAll('.tab-panel').forEach(panel => {
        panel.classList.remove('active');
      });
      
      // Remove active class from all tab buttons
      document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active', 'bg-green-500', 'text-white');
        button.classList.add('text-gray-600', 'dark:text-gray-300', 'hover:bg-gray-200', 'dark:hover:bg-gray-600');
      });
      
      // Show selected tab panel
      const tabContent = document.getElementById(tabName + '-content');
      if (tabContent) {
        tabContent.classList.add('active');
      }
      
      // Add active class to selected tab button
      const activeButton = document.getElementById(tabName + '-tab');
      if (activeButton) {
        activeButton.classList.add('active', 'bg-green-500', 'text-white');
        activeButton.classList.remove('text-gray-600', 'dark:text-gray-300', 'hover:bg-gray-200', 'dark:hover:bg-gray-600');
      }
    }
  </script>

  <style>
    .tab-panel {
      display: none;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s ease-in-out;
    }
    
    .tab-panel.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }
    
    .tab-button {
      transition: all 0.3s ease-in-out;
    }
    
    .tab-button:hover {
      transform: translateY(-1px);
    }
    
    .tab-button.active {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
    }
  </style>

  <!-- Orari e Trasporti Section **************** -->

  <div class="py-16 bg-gray-50 dark:bg-secondary">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <!-- Orari di Apertura -->
        <Card>
          <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
            üïê Orari di Apertura
          </h3>
          <div class="space-y-4">
            {contattiData.openingHours.map((schedule) => (
              <div class="border-l-4 border-purple-500 pl-4">
                <h4 class="font-semibold text-gray-800 dark:text-white mb-2">
                  {schedule.days.join(', ')}
                </h4>
                <p class="text-gray-600 dark:text-gray-300">
                  {schedule.hours.open} - {schedule.hours.close}
                </p>
              </div>
            ))}
          </div>
        </Card>

        <!-- Come Raggiungerci -->
        <Card>
          <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
            üöá Come Raggiungerci
          </h3>
          <div class="space-y-4">
            <div>
              <h4 class="font-semibold text-gray-800 dark:text-white mb-2">
                üöá Metro
              </h4>
              <p class="text-gray-600 dark:text-gray-300">
                {contattiData.transport.metro.line} - Stazione {contattiData.transport.metro.station}
                <br>
                <span class="text-sm text-gray-500">({contattiData.transport.metro.walkingTime} a piedi)</span>
              </p>
            </div>
            <div>
              <h4 class="font-semibold text-gray-800 dark:text-white mb-2">
                üöå Autobus
              </h4>
              <p class="text-gray-600 dark:text-gray-300">
                Linee {contattiData.transport.bus[0].lines.join(', ')} - Fermata {contattiData.transport.bus[0].stop}
              </p>
            </div>
            <div>
              <h4 class="font-semibold text-gray-800 dark:text-white mb-2">
                üÖøÔ∏è Parcheggio
              </h4>
              <p class="text-gray-600 dark:text-gray-300">
                {contattiData.transport.parking[0].description}
              </p>
            </div>
          </div>
        </Card>

      </div>
    </div>
  </div>

  <!-- Social Media Section **************** -->

  <div class="py-16 bg-white dark:bg-secondary">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-8">
        üì± Seguici sui Social
      </h3>
      <div class="flex flex-wrap justify-center gap-6">
        {contattiData.socialMedia.map((social) => (
          social.url && (
            <CTAButton 
              href={social.url} 
              text={social.platform === 'facebook' ? 'üìò Facebook' : 
                    social.platform === 'instagram' ? 'üì∑ Instagram' :
                    social.platform === 'discord' ? 'üéÆ Discord' :
                    social.platform === 'youtube' ? 'üì∫ YouTube' : social.platform}
              target="_blank"
            />
          )
        ))}
      </div>
    </div>
  </div>

  <!-- Features2 Widget ************** -->

  <Features2
    title="Come contattarci"
    items={[
      {
        title: 'Prenotazioni',
        description: `Chiamaci per prenotare un tavolo, organizzare eventi privati o per qualsiasi domanda sui nostri giochi e servizi.`,
      },
      {
        title: 'Informazioni',
        description:
          'Hai domande sui nostri orari, sui giochi disponibili, sui tornei o su come diventare socio? Siamo qui per te!',
      },
      {
        title: 'Eventi e Tornei',
        description:
          'Vuoi organizzare un torneo, partecipare a un evento speciale o proporre una nuova attivit√†? Contattaci!',
      },
      {
        title: 'Telefono',
        description: formatPhoneNumber(contattiData.contact.phone),
        icon: 'tabler:phone',
      },
      {
        title: 'Email',
        description: contattiData.contact.email,
        icon: 'tabler:mail',
      },
      {
        title: 'Indirizzo',
        description: `${contattiData.address.street}, ${contattiData.address.neighborhood}, ${contattiData.address.city}`,
        icon: 'tabler:map-pin',
      },
    ]}
  />
</Layout>
